<!DOCTYPE html>
<html>
<head>
</head>
<link href="https://fonts.googleapis.com/css?family=Hind" rel="stylesheet">
<script src="https://d3js.org/d3.v4.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet">
<style>
  body {font-family: 'Roboto Condensed', sans-serif;}
  .top {z-index: 100;}
</style>
<body bgcolor="#000000">
  <div id = 'window'></div>
  <div id = 'window2'></div>
  <script src = "tooltips.js"></script>
  <script src = "plots.js"></script>
  <script>
    var HUEBIN = 8;
    var ROLL = 120;

    function translate(x,y){return "translate(" +x+ "," +y+")";};

    function parse(line){
      var countries = line.country.split(/\[|, |\]/).filter(function(d){return d.length != 0}).map(function(d){
        var temp = d.replace('\'','');
        return temp.replace('\'','')
      });
      var genre = line.genre.split(/\[|, |\]/).filter(function(d){return d.length != 0}).map(function(d){
        var temp = d.replace('\'','');
        return temp.replace('\'','')
      });
      var dominant = line.dominant_color.split(/\(|, |\)/).filter(function(d){return d.length != 0}).map(d=>Number(d));
      var dominant_hsl = d3.hsl(d3.rgb(dominant[0],dominant[1],dominant[2]));
      var url = line.file_urls.split(/\[|, |\]/);
      var dominant_sat = d3.hsl(dominant_hsl.h,1,dominant_hsl.l);
      var dominant_lit = d3.hsl(dominant_hsl.h,dominant_hsl.s,0.5);
      var hue_loc = dominant_hsl.h-ROLL;
      if (hue_loc < 0){
        hue_loc += 360;
      }
      // dominant_sat.s = 1;
      return {
        "countries" : countries,
        "director" : line.director,
        "like" : Number(line.liked),
        "watched" : Number(line.watched),
        "rate" :  Math.floor(Number(line.rating)),
        "year" : Number(line.year),
        "title" : line.title,
        "genre" : genre,
        "dominant_color" : dominant,
        "dominant_hsl" : dominant_hsl,
        "hue" : Math.floor(dominant_hsl.h/(360/HUEBIN)),
        "url" : url[1],
        "dominant_sat" : dominant_sat,
        "dominant_lit" : dominant_lit,
        "hue_loc" : hue_loc,
        "show" : true
      }
    }
    var srcdata;
    var newdata;
    var svg;

    d3.csv("data/movie_poster_data.csv", parse, function(error, data) {
      if (error) throw error;
      srcdata = data;

      newdata = [];
      var OLDEST = 1968;
      for (var i = 0; i < 50; i++){
        var year = srcdata.filter(d => d.year === i+OLDEST);
        year.slice(0, 100).forEach(function(d){
          newdata.push(d);
        });
      };

      newdata.sort(
        function(a,b){
          if (a.year!=b.year){
             return (a.dominant_hsl.s-b.dominant_hsl.s);
          } else {
             return (a.year>b.year?1:-1);
          }
        });

      newdata = newdata.filter(function(d){
        return ! isNaN(d.dominant_hsl.h)
      });

      svg = d3.select("#window2")
      .append('svg')
      .attr('width', 1200)
      .attr('height', 1200);

      radial_scatter(newdata, svg);


    });
  </script>
</body>
</html>
