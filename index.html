<!DOCTYPE html>
<html>
<head>
</head>
<link href="https://fonts.googleapis.com/css?family=Hind" rel="stylesheet">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-voronoi.v1.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<body>
  <!-- dropdown for search or filter -->
  <div class="dropdown">
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg, 'all')">All</button>
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg,'comedy')">Comedy</button>
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg,'horror')">Horror</button>
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg,'romance')">Romance</button>
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg,'animation')">Animation</button>
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg,'science fiction')">Science Fiction</button>
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg,'war')">War</button>
    <button class="dropbtn" onclick="filter_genre_r(newdata,svg,'western')">Western</button>
  </div>

  <div id = 'window2'></div>
  <div id = 'window'></div>
  <div id = 'window3'></div>
  <script src = "tooltips.js"></script>
  <script src = "plots.js"></script>
  <script src="streamgraph.js"></script>
  <script src="heatmap.js"></script>
  <script>
    var HUEBIN = 6;
    var ROLL = 90;
    var HROLL = 180;
    // favorite helper function
    function translate(x,y){return "translate(" +x+ "," +y+")";};
    // parse each line
    function parse(line){
      // get countries
      var countries = line.country.split(/\[|, |\]/).filter(function(d){return d.length != 0}).map(function(d){
        var temp = d.replace('\'','');
        return temp.replace('\'','')
      });
      // get genres
      var genre = line.genre.split(/\[|, |\]/).filter(function(d){return d.length != 0}).map(function(d){
        var temp = d.replace('\'','');
        return temp.replace('\'','')
      });
      // get d3 hel class
      var dominant = line.dominant_color.split(/\(|, |\)/).filter(function(d){return d.length != 0}).map(d=>Number(d));
      var dominant_hsl = d3.hsl(d3.rgb(dominant[0],dominant[1],dominant[2]));
      // get image url
      var url = line.file_urls.split(/\[|, |\]/);
      // rotate the hue by 90
      var hue_loc = dominant_hsl.h-ROLL;
      if (hue_loc < 0){
        hue_loc += 360;
      }
      return {
        // "countries" : countries,
        "director" : line.director,
        "like" : Number(line.liked),
        "watched" : Number(line.watched),
        "rate" :  Math.floor(Number(line.rating)),
        "year" : Number(line.year),
        "title" : line.title,
        "genre" : genre,
        "dominant_hsl" : dominant_hsl,
        "hue" : Math.floor(dominant_hsl.h/(360/HUEBIN)),
        "url" : url[1],
        "hue_loc" : hue_loc,
        "show" : true
      }
    }
    var srcdata;
    var newdata;
    var svg;

    d3.csv("data/movie_poster_data.csv", parse, function(error, data) {
      if (error) throw error;
      srcdata = data;
      newdata = [];
      // take 100 movies a year
      var OLDEST = 1968;
      for (var i = 0; i < 50; i++){
        var year = srcdata.filter(d => d.year === i+OLDEST);
        year.slice(0, 100).forEach(function(d){
          newdata.push(d);
        });
      };
      // sort by year and saturation for better plotting result
      newdata.sort(
        function(a,b){
          if (a.year!=b.year){
             return (a.dominant_hsl.s-b.dominant_hsl.s);
          } else {
             return (a.year>b.year?1:-1);
          }
        });
      // get rid of completely black / white posters
      newdata = newdata.filter(function(d){
        return ! isNaN(d.dominant_hsl.h)
      });
      // insert svg
      svg = d3.select("#window2")
      .append('svg')
      .attr('width', 1000)
      .attr('height', 800);
      // create a graph
      radial_scatter(newdata, svg);
      plot_timeseries(newdata, svg);

      // // insert svg for stream graph
      // svgStream = d3.select("#window")
      // .append('svg')
      // .attr('width', 1000)
      // .attr('height', 300);
      //
      // var heat = d3.select("#window3")
      // .append('svg')
      // .attr('width', 1000)
      // .attr('height', 700);
      // // create a stream graph
      // plot_streamgraph(newdata, svgStream);
      // plot_heatmap(newdata, heat);

    });
  </script>
</body>
</html>
